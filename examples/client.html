<!DOCTYPE html>
<html>
<head>
	<title>Test Page</title>
</head>
<body>
	<div id="out"></div>
	<script src="../src/Template.js"></script>
	<script id="template" type="text/template">
	<![CDATA[
		<div>
			<?# 'nested' ?>
			<?# 'nested', { msg: 'Custom data passed to child template' } ?>
			<? var k = 0; // this comment will end with the end hook. ?>
			<table>
			<? for (var i = 0; i < 1000; ++i, ++k) { ?>
				<tr class="<?= k % 2 ? 'odd' : 'even' // comments should be fine in any code tag ?>">
					<th><?= k ?></th>
					<td>This is the <?= k, (k % 100 > 10 && k % 100 < 20) ? 'th' : data.suffix[Math.min(k % 10, 4)] ?> row.</td>
				</tr>
			<? } ?>
			</table>
			<pre>
				This text should be <? ?>
unbroken by newline.
			</pre>
			<? /* some bad syntax ?> this is all commented out <? */ ?>
		</div>
	]]>
	</script>
	<script id="nested" type="text/template">
		<![CDATA[<div><?= data.msg ?></div>]]>
	</script>
	<script>
		var out = document.getElementById('out'), // output div
			done, init, cmpl, exec, wait, end, // timing vars
			start = (new Date()).getTime();

		var str = '';
		function ondata(data) { str += data; }

		function output() {
			// output onto the page
			wait = (new Date()).getTime();
			out.innerHTML += str;
			end  = (new Date()).getTime();

			// preped timing information
			out.innerHTML = 
				'init: '        + (init - start) +
				'ms compile: '  + (cmpl - init) +
				'ms execute: '  + (exec - cmpl) +
				'ms complete: ' + (done - cmpl) +
				'ms write: '    + (end  - wait) +
				'ms total: '    + (done - start + end - wait) +
				'ms <br/><br/>' + out.innerHTML;

			// don't execute twice
			output = function(){};
		}

		// initialize the template
		var template = new Template({ id:'template' });
		init = (new Date()).getTime();

		// compile the template
		template.compile(function(){
			cmpl = (new Date()).getTime();
			
			// execute the template
			template.exec({
				suffix:[ 'th', 'st', 'nd', 'rd', 'th' ],
				msg:'Message in nested template'
			}, {
				ondata:ondata,
				onend:function() {
					done = (new Date()).getTime();
					// make sure exec timing is done
					if (exec) { output(); }
				}
			});
			exec = (new Date()).getTime();

			// make sure complete timing is done
			if (done) { output(); }
		});
	</script>
</body>
</html>
